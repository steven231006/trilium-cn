(()=>{var e,t,o={5866:(e,t,o)=>{"use strict";o.d(t,{A:()=>a});var n=o(8520);function r(e,t,o=null){i($(document),e,t,o)}function i(e,t,o,r=null){if(n.A.isDesktop()){t=s(t);let n="keydown";r&&(n+=`.${r}`,e.off(n)),t&&e.bind(n,t,(e=>{o(e),e.preventDefault(),e.stopPropagation()}))}}function s(e){return e?e.toLowerCase().replace("enter","return").replace("delete","del").replace("ctrl+alt","alt+ctrl").replace("meta+alt","alt+meta"):e}const a={bindGlobalShortcut:r,bindElShortcut:i,removeGlobalShortcut:function(e){r("",null,e)},normalizeShortcut:s}},8520:(e,t,o)=>{"use strict";function n(e){return`${e<=9?"0":""}${e}`}function r(e){return`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())}`}function i(){return!!(window&&window.process&&window.process.type)}function s(){return navigator.platform.indexOf("Mac")>-1}o.d(t,{A:()=>b});const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function c(){glob.activeDialog&&(glob.activeDialog.modal("hide"),glob.activeDialog=null)}let u=null;function l(){u=$(":focus")}function p(){if(u){if(u.hasClass("ck")){const e=u.closest(".ck-editor__editable").prop("ckeditorInstance");e?e.editing.view.focus():console.log("Could not find CKEditor instance to focus last element")}else u.focus();u=null}}function f(e){return"undefined"!=typeof require?require(e):o(5368)(e)}const d="https://github.com/zadam/trilium/wiki/";function m(e){const t=e.attr("data-help-page");if(t){const e=d+t;window.open(e,"_blank")}}function h(e){e.on("click",(e=>{m($(e.target).closest("[data-help-page]"))}))}const g=new RegExp("^[\\p{L}\\p{N}_:]+$","u"),b={reloadFrontendApp:function(e){e&&logInfo(`Frontend app reload: ${e}`),window.location.reload()},parseDate:function(e){try{return new Date(Date.parse(e))}catch(t){throw new Error(`Can't parse date from '${e}': ${t.message} ${t.stack}`)}},formatDateISO:r,formatDateTime:function(e){return`${function(e){return r(e)}(e)} ${function(e){return`${n(e.getHours())}:${n(e.getMinutes())}`}(e)}`},formatTimeInterval:function(e){const t=Math.round(e/1e3),o=Math.floor(t/60),n=Math.floor(o/60),r=Math.floor(n/24),i=(e,t)=>`${e} ${t}`,s=[];return r>0&&s.push(i(r,"天")),r<2&&(n%24>0&&s.push(i(n%24,"小时")),n<4&&(o%60>0&&s.push(i(o%60,"分钟")),o<5&&t%60>0&&s.push(i(t%60,"秒")))),s.join(", ")},formatSize:function(e){return(e=Math.max(Math.round(e/1024),1))<1024?`${e} KiB`:Math.round(e/102.4)/10+" MiB"},localNowDateTime:function(){return dayjs().format("YYYY-MM-DD HH:mm:ss.SSSZZ")},now:function(){return`${n((e=new Date).getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}`;var e},isElectron:i,isMac:s,isCtrlKey:function(e){return!s()&&e.ctrlKey||s()&&e.metaKey},assertArguments:function(){for(const e in arguments)arguments[e]||console.trace(`Argument idx#${e} should not be falsy: ${arguments[e]}`)},escapeHtml:function(e){return e.replace(/[&<>"'`=\/]/g,(e=>a[e]))},toObject:function(e,t){const o={};for(const n of e){const[e,r]=t(n);o[e]=r}return o},randomString:function(e){let t="";for(let o=0;o<e;o++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t},isMobile:function(){return"mobile"===window.glob?.device||!window.glob?.device&&/Mobi/.test(navigator.userAgent)},isDesktop:function(){return"desktop"===window.glob?.device||!window.glob?.device&&!/Mobi/.test(navigator.userAgent)},setCookie:function(e,t){const o=`; expires=${new Date(Date.now()+31536e7).toUTCString()}`;document.cookie=`${e}=${t||""}${o};`},getNoteTypeClass:function(e){return`type-${e}`},getMimeTypeClass:function(e){if(!e)return"";const t=e.indexOf(";");return-1!==t&&(e=e.substr(0,t)),`mime-${e.toLowerCase().replace(/[\W_]+/g,"-")}`},closeActiveDialog:c,openDialog:async function(e,t=!0){t&&(c(),glob.activeDialog=e),l(),e.modal(),e.on("hidden.bs.modal",(()=>{$(".aa-input").autocomplete("close"),glob.activeDialog&&glob.activeDialog!==e||p()})),(await o.e(41).then(o.bind(o,9780))).default.updateDisplayedShortcuts(e)},saveFocusedElement:l,focusSavedElement:p,isHtmlEmpty:function(e){return!(e&&("string"!=typeof e?(logError(`Got object of type '${typeof e}' where string was expected.`),1):(e=e.toLowerCase()).includes("<img")||e.includes("<section")||0!==$("<div>").html(e).text().trim().length))},clearBrowserCache:async function(){if(i()){const e=f("@electron/remote").getCurrentWindow();await e.webContents.session.clearCache()}},copySelectionToClipboard:function(){const e=window.getSelection().toString();navigator.clipboard&&navigator.clipboard.writeText(e)},dynamicRequire:f,timeLimit:function(e,t,o){if(!e||!e.then)return e;const n=new Error(o||`Process exceeded time limit ${t}`);return new Promise(((o,r)=>{let i=!1;e.then((e=>{i=!0,o(e)})),setTimeout((()=>{i||r(n)}),t)}))},initHelpDropdown:function(e){const t=e.find(".help-dropdown .dropdown-menu");t.on("click",(e=>e.stopPropagation())),h(t)},initHelpButtons:h,openHelp:m,filterAttributeName:function(e){return e.replace(/[^\p{L}\p{N}_:]/gu,"")},isValidAttributeName:function(e){return g.test(e)},sleep:function(e){return new Promise((t=>{setTimeout(t,e)}))},escapeRegExp:function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},areObjectsEqual:function(){let e,t,o,n;function r(e,t){let i;if(isNaN(e)&&isNaN(t)&&"number"==typeof e&&"number"==typeof t)return!0;if(e===t)return!0;if("function"==typeof e&&"function"==typeof t||e instanceof Date&&t instanceof Date||e instanceof RegExp&&t instanceof RegExp||e instanceof String&&t instanceof String||e instanceof Number&&t instanceof Number)return e.toString()===t.toString();if(!(e instanceof Object&&t instanceof Object))return!1;if(e.isPrototypeOf(t)||t.isPrototypeOf(e))return!1;if(e.constructor!==t.constructor)return!1;if(e.prototype!==t.prototype)return!1;if(o.indexOf(e)>-1||n.indexOf(t)>-1)return!1;for(i in t){if(t.hasOwnProperty(i)!==e.hasOwnProperty(i))return!1;if(typeof t[i]!=typeof e[i])return!1}for(i in e){if(t.hasOwnProperty(i)!==e.hasOwnProperty(i))return!1;if(typeof t[i]!=typeof e[i])return!1;switch(typeof e[i]){case"object":case"function":if(o.push(e),n.push(t),!r(e[i],t[i]))return!1;o.pop(),n.pop();break;default:if(e[i]!==t[i])return!1}}return!0}if(arguments.length<1)return!0;for(e=1,t=arguments.length;e<t;e++)if(o=[],n=[],!r(arguments[0],arguments[e]))return!1;return!0},copyHtmlToClipboard:function(e){function t(t){t.clipboardData.setData("text/html",e),t.clipboardData.setData("text/plain",e),t.preventDefault()}document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)},createImageSrcUrl:function(e){return`api/images/${e.noteId}/${encodeURIComponent(e.title)}?timestamp=${Date.now()}`}}},5368:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=5368,e.exports=t}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return o[e](i,i.exports,r),i.exports}r.m=o,r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,o)=>(r.f[o](e,t),t)),[])),r.u=e=>e+".js",r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="trilium:",r.l=(o,n,i,s)=>{if(e[o])e[o].push(n);else{var a,c;if(void 0!==i)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var p=u[l];if(p.getAttribute("src")==o||p.getAttribute("data-webpack")==t+i){a=p;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",t+i),a.src=o),e[o]=[n];var f=(t,n)=>{a.onerror=a.onload=null,clearTimeout(d);var r=e[o];if(delete e[o],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(n))),t)return t(n)},d=setTimeout(f.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=f.bind(null,a.onerror),a.onload=f.bind(null,a.onload),c&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="assets/v0.63.7/app-dist/",(()=>{var e={930:0};r.f.j=(t,o)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var i=new Promise(((o,r)=>n=e[t]=[o,r]));o.push(n[2]=i);var s=r.p+r.u(t),a=new Error;r.l(s,(o=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,n[1](a)}}),"chunk-"+t,t)}};var t=(t,o)=>{var n,i,[s,a,c]=o,u=0;if(s.some((t=>0!==e[t]))){for(n in a)r.o(a,n)&&(r.m[n]=a[n]);c&&c(r)}for(t&&t(o);u<s.length;u++)i=s[u],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0},o=global.webpackChunktrilium=global.webpackChunktrilium||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),(()=>{"use strict";var e=r(8520),t=r(5866);function o(e){return document.execCommand(e),!1}async function n(){const{outstandingPullCount:t,initialized:o}=await $.get("api/sync/stats");if(o)if(e.A.isElectron()){const t=e.A.dynamicRequire("@electron/remote");t.app.relaunch(),t.app.exit(0)}else e.A.reloadFrontendApp();else $("#outstanding-syncs").html(t)}function i(e){$("#alert").html(e),$("#alert").show()}e.A.isElectron()&&e.A.isMac()&&(t.A.bindGlobalShortcut("meta+c",(()=>o("copy"))),t.A.bindGlobalShortcut("meta+v",(()=>o("paste"))),t.A.bindGlobalShortcut("meta+x",(()=>o("cut"))),t.A.bindGlobalShortcut("meta+a",(()=>o("selectAll"))),t.A.bindGlobalShortcut("meta+z",(()=>o("undo"))),t.A.bindGlobalShortcut("meta+y",(()=>o("redo")))),ko.applyBindings(new function(){syncInProgress&&setInterval(n,1e3);const e=`${location.protocol}//${location.host}`;$("#current-host").html(e),this.step=ko.observable(syncInProgress?"sync-in-progress":"setup-type"),this.setupType=ko.observable(),this.setupNewDocument=ko.observable(!1),this.setupSyncFromDesktop=ko.observable(!1),this.setupSyncFromServer=ko.observable(!1),this.syncServerHost=ko.observable(),this.syncProxy=ko.observable(),this.password=ko.observable(),this.setupTypeSelected=()=>!!this.setupType(),this.selectSetupType=()=>{"new-document"===this.setupType()?(this.step("new-document-in-progress"),$.post("api/setup/new-document").then((()=>{window.location.replace("./setup")}))):this.step(this.setupType())},this.back=()=>{this.step("setup-type"),this.setupType("")},this.finish=async()=>{const e=this.syncServerHost(),t=this.syncProxy(),o=this.password();if(!e)return void i("Trilium服务器地址不能为空");if(!o)return void i("密码不能为空");const r=await $.post("api/setup/sync-from-server",{syncServerHost:e,syncProxy:t,password:o});"success"===r.result?(this.step("sync-in-progress"),setInterval(n,1e3),$("#alert").hide()):i(`Sync setup failed: ${r.error}`)}},document.getElementById("setup-dialog")),$("#setup-dialog").show()})()})();
//# sourceMappingURL=setup.js.map