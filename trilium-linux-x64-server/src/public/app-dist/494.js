"use strict";(global.webpackChunktrilium=global.webpackChunktrilium||[]).push([[494],{1494:(e,t,o)=>{o.r(t),o.d(t,{default:()=>p});var n=o(8481),a=o(1412),d=o(1035),i=o(8181),c=o(1801),l=o(2817),b=o(4733),s=o(1736),m=o(6885),r=o(3152);class p{constructor(e,t){this.treeWidget=e,this.node=t}async show(e){c.Z.show({x:e.pageX,y:e.pageY,items:await this.getMenuItems(),selectMenuItemHandler:(e,t)=>this.selectMenuItemHandler(e)})}async getMenuItems(){const e=await a.default.getNote(this.node.data.noteId),t=a.default.getBranch(this.node.data.branchId),o="root"!==e.noteId,n=e.noteId===l.default.tabManager.getActiveContext().hoistedNoteId,i=o?await a.default.getNote(t.parentNoteId):null,c=this.treeWidget.getSelectedNodes(),s=0===c.length||1===c.length&&c[0]===this.node,m="search"!==e.type,r=!i||"search"!==i.type,p=o&&!n&&r;return[{title:"Open in a new tab <kbd>Ctrl+Click</kbd>",command:"openInTab",uiIcon:"bx bx-empty",enabled:s},{title:"Open in a new split",command:"openNoteInSplit",uiIcon:"bx bx-dock-right",enabled:s},{title:'Insert note after <kbd data-command="createNoteAfter"></kbd>',command:"insertNoteAfter",uiIcon:"bx bx-plus",items:p?await b.Z.getNoteTypeItems("insertNoteAfter"):null,enabled:p&&s},{title:'Insert child note <kbd data-command="createNoteInto"></kbd>',command:"insertChildNote",uiIcon:"bx bx-plus",items:m?await b.Z.getNoteTypeItems("insertChildNote"):null,enabled:m&&s},{title:'Delete <kbd data-command="deleteNotes"></kbd>',command:"deleteNotes",uiIcon:"bx bx-trash",enabled:o&&!n&&r},{title:"----"},{title:'Search in subtree <kbd data-command="searchInSubtree"></kbd>',command:"searchInSubtree",uiIcon:"bx bx-search",enabled:m&&s},n?null:{title:'Hoist note <kbd data-command="toggleNoteHoisting"></kbd>',command:"toggleNoteHoisting",uiIcon:"bx bx-empty",enabled:s&&m},n&&o?{title:'Unhoist note <kbd data-command="toggleNoteHoisting"></kbd>',command:"toggleNoteHoisting",uiIcon:"bx bx-door-open"}:null,{title:'Edit branch prefix <kbd data-command="editBranchPrefix"></kbd>',command:"editBranchPrefix",uiIcon:"bx bx-empty",enabled:o&&r&&s},{title:"Advanced",uiIcon:"bx bx-empty",enabled:!0,items:[{title:'Expand subtree <kbd data-command="expandSubtree"></kbd>',command:"expandSubtree",uiIcon:"bx bx-expand",enabled:s},{title:'Collapse subtree <kbd data-command="collapseSubtree"></kbd>',command:"collapseSubtree",uiIcon:"bx bx-collapse",enabled:s},{title:'Sort by ... <kbd data-command="sortChildNotes"></kbd>',command:"sortChildNotes",uiIcon:"bx bx-empty",enabled:s&&m},{title:"Recent changes in subtree",command:"recentChangesInSubtree",uiIcon:"bx bx-history",enabled:s},{title:"Convert to attachment",command:"convertNoteToAttachment",uiIcon:"bx bx-empty",enabled:o&&!n},{title:"Copy note path to clipboard",command:"copyNotePathToClipboard",uiIcon:"bx bx-empty",enabled:!0}]},{title:"----"},{title:"Protect subtree",command:"protectSubtree",uiIcon:"bx bx-check-shield",enabled:s},{title:"Unprotect subtree",command:"unprotectSubtree",uiIcon:"bx bx-shield",enabled:s},{title:"----"},{title:'Copy / clone <kbd data-command="copyNotesToClipboard"></kbd>',command:"copyNotesToClipboard",uiIcon:"bx bx-copy",enabled:o&&!n},{title:'Clone to ... <kbd data-command="cloneNotesTo"></kbd>',command:"cloneNotesTo",uiIcon:"bx bx-empty",enabled:o&&!n},{title:'Cut <kbd data-command="cutNotesToClipboard"></kbd>',command:"cutNotesToClipboard",uiIcon:"bx bx-cut",enabled:o&&!n&&r},{title:'Move to ... <kbd data-command="moveNotesTo"></kbd>',command:"moveNotesTo",uiIcon:"bx bx-empty",enabled:o&&!n&&r},{title:'Paste into <kbd data-command="pasteNotesFromClipboard"></kbd>',command:"pasteNotesFromClipboard",uiIcon:"bx bx-paste",enabled:!d.Z.isClipboardEmpty()&&m&&s},{title:"Paste after",command:"pasteNotesAfterFromClipboard",uiIcon:"bx bx-paste",enabled:!d.Z.isClipboardEmpty()&&o&&!n&&r&&s},{title:'Duplicate subtree <kbd data-command="duplicateSubtree">',command:"duplicateSubtree",uiIcon:"bx bx-empty",enabled:r&&o&&!n},{title:"----"},{title:"Export",command:"exportNote",uiIcon:"bx bx-empty",enabled:m&&s},{title:"Import into note",command:"importIntoNote",uiIcon:"bx bx-empty",enabled:m&&s},{title:"Apply bulk actions",command:"openBulkActionsDialog",uiIcon:"bx bx-list-plus",enabled:!0}].filter((e=>null!==e))}async selectMenuItemHandler({command:e,type:t,templateNoteId:o}){const d=n.Z.getNotePath(this.node);if("openInTab"===e)l.default.tabManager.openTabWithNoteWithHoisting(d);else if("insertNoteAfter"===e){const e=n.Z.getNotePath(this.node.getParent()),a=n.Z.getParentProtectedStatus(this.node);i.Z.createNote(e,{target:"after",targetBranchId:this.node.data.branchId,type:t,isProtected:a,templateNoteId:o})}else if("insertChildNote"===e){const e=n.Z.getNotePath(this.node);i.Z.createNote(e,{type:t,isProtected:this.node.data.isProtected,templateNoteId:o})}else if("openNoteInSplit"===e){const e=l.default.tabManager.getActiveContext().getSubContexts(),{ntxId:t}=e[e.length-1];this.treeWidget.triggerCommand("openNewNoteSplit",{ntxId:t,notePath:d})}else if("convertNoteToAttachment"===e){if(!await r.Z.confirm("Are you sure you want to convert note selected notes into attachments of their parent notes?"))return;let e=0;for(const t of this.treeWidget.getSelectedOrActiveNoteIds(this.node)){const o=await a.default.getNote(t);if(o.isEligibleForConversionToAttachment()){const{attachment:t}=await s.Z.post(`notes/${o.noteId}/convert-to-attachment`);t&&e++}}m.default.showMessage(`${e} notes have been converted to attachments.`)}else"copyNotePathToClipboard"===e?navigator.clipboard.writeText("#"+d):this.treeWidget.triggerCommand(e,{node:this.node,notePath:d,noteId:this.node.data.noteId,selectedOrActiveBranchIds:this.treeWidget.getSelectedOrActiveBranchIds(this.node),selectedOrActiveNoteIds:this.treeWidget.getSelectedOrActiveNoteIds(this.node)})}}},4733:(e,t,o)=>{o.d(t,{Z:()=>d});var n=o(1736),a=o(1412);const d={getNoteTypeItems:async function(e){const t=[{title:"Text",command:e,type:"text",uiIcon:"bx bx-note"},{title:"Code",command:e,type:"code",uiIcon:"bx bx-code"},{title:"Saved Search",command:e,type:"search",uiIcon:"bx bx-file-find"},{title:"Relation Map",command:e,type:"relationMap",uiIcon:"bx bx-map-alt"},{title:"Note Map",command:e,type:"noteMap",uiIcon:"bx bx-map-alt"},{title:"Render Note",command:e,type:"render",uiIcon:"bx bx-extension"},{title:"Book",command:e,type:"book",uiIcon:"bx bx-book"},{title:"Mermaid Diagram",command:e,type:"mermaid",uiIcon:"bx bx-selection"},{title:"Canvas",command:e,type:"canvas",uiIcon:"bx bx-pen"},{title:"Web View",command:e,type:"webView",uiIcon:"bx bx-globe-alt"}],o=await n.Z.get("search-templates"),d=await a.default.getNotes(o);if(d.length>0){t.push({title:"----"});for(const o of d)t.push({title:o.title,uiIcon:o.getIcon(),command:e,type:o.type,templateNoteId:o.noteId})}return t}}}}]);
//# sourceMappingURL=494.js.map