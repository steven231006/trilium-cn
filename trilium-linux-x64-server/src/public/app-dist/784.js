"use strict";(global.webpackChunktrilium=global.webpackChunktrilium||[]).push([[784],{5784:(e,t,s)=>{s.r(t),s.d(t,{default:()=>p,uploadFiles:()=>d});var a=s(978),o=s(9564),r=s(3948),n=s(8520),i=s(4611);async function d(e,t,s,r){if(!["notes","attachments"].includes(e))throw new Error(`Unrecognized import entity type '${e}'.`);if(0===s.length)return;const i=n.A.randomString(10);let d=0;for(const n of s){d++;const l=new FormData;l.append("upload",n),l.append("taskId",i),l.append("last",d===s.length?"true":"false");for(const e in r)l.append(e,r[e]);await $.ajax({url:`${window.glob.baseApiUrl}notes/${t}/${e}-import`,headers:await o.A.getHeaders(),data:l,dataType:"json",type:"POST",timeout:36e5,error:function(e){a.default.showError(`Import failed: ${e.responseText}`)},contentType:!1,processData:!1})}}function l(e,t){return{id:e,title:"导入状态",message:t,icon:"plus"}}r.A.subscribeToMessages((async e=>{if("importNotes"===e.taskType)if("taskError"===e.type)a.default.closePersistent(e.taskId),a.default.showError(e.message);else if("taskProgressCount"===e.type)a.default.showPersistent(l(e.taskId,`Import in progress: ${e.progressCount}`));else if("taskSucceeded"===e.type){const t=l(e.taskId,"导入成功.");t.closeAfter=5e3,a.default.showPersistent(t),e.result.importedNoteId&&await i.default.tabManager.getActiveContext().setNote(e.result.importedNoteId)}})),r.A.subscribeToMessages((async e=>{if("importAttachments"===e.taskType)if("taskError"===e.type)a.default.closePersistent(e.taskId),a.default.showError(e.message);else if("taskProgressCount"===e.type)a.default.showPersistent(l(e.taskId,`Import in progress: ${e.progressCount}`));else if("taskSucceeded"===e.type){const t=l(e.taskId,"导入成功.");t.closeAfter=5e3,a.default.showPersistent(t),e.result.parentNoteId&&await i.default.tabManager.getActiveContext().setNote(e.result.importedNoteId,{viewScope:{viewMode:"attachments"}})}}));const p={uploadFiles:d}}}]);
//# sourceMappingURL=784.js.map